<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Engineering Student Burnout Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Barlow+Condensed:wght@300;400;600;700;900&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #0d0d0f;
    --surface: #141418;
    --surface2: #1c1c22;
    --border: #2a2a35;
    --ember: #ff5e1a;
    --ember-dim: #c44010;
    --ash: #8a8a9a;
    --smoke: #4a4a5a;
    --text: #e8e8f0;
    --text-dim: #9090a8;
    --year1: #ff5e1a;
    --year2: #ffaa00;
    --year3: #00c4ff;
    --year4: #a855f7;
    --highlight: rgba(255,94,26,0.15);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Barlow Condensed', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Background noise texture */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.5;
  }

  /* Ember glow line at top */
  body::after {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--ember), transparent);
    z-index: 100;
  }

  header {
    position: relative;
    z-index: 1;
    padding: 2.5rem 3rem 1.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    gap: 2rem;
  }

  .header-left h1 {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: clamp(2.4rem, 5vw, 4rem);
    letter-spacing: -0.01em;
    line-height: 0.9;
    text-transform: uppercase;
  }

  h1 span.burn { color: var(--ember); }
  h1 span.out { color: var(--text-dim); font-weight: 300; }

  .header-left p {
    margin-top: 0.6rem;
    font-family: 'Space Mono', monospace;
    font-size: 0.72rem;
    color: var(--ash);
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }

  .header-stats {
    display: flex;
    gap: 2rem;
    flex-shrink: 0;
  }

  .stat-pill {
    text-align: right;
  }

  .stat-pill .num {
    display: block;
    font-family: 'Space Mono', monospace;
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--ember);
    line-height: 1;
  }

  .stat-pill .lbl {
    font-size: 0.7rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ash);
  }

  /* Filter bar */
  .filter-bar {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 3rem;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    flex-wrap: wrap;
  }

  .filter-label {
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ash);
    margin-right: 0.5rem;
  }

  .year-btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.35rem 1rem;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-dim);
    cursor: pointer;
    transition: all 0.18s;
    position: relative;
    overflow: hidden;
  }

  .year-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--c, var(--ember));
    opacity: 0;
    transition: opacity 0.18s;
  }

  .year-btn:hover::before, .year-btn.active::before { opacity: 0.15; }
  .year-btn.active { border-color: var(--c, var(--ember)); color: var(--text); }
  .year-btn span { position: relative; }

  .year-btn[data-year="1"] { --c: var(--year1); }
  .year-btn[data-year="2"] { --c: var(--year2); }
  .year-btn[data-year="3"] { --c: var(--year3); }
  .year-btn[data-year="4"] { --c: var(--year4); }
  .year-btn[data-year="all"] { --c: var(--ember); }

  .reset-btn {
    margin-left: auto;
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    background: transparent;
    border: none;
    color: var(--smoke);
    cursor: pointer;
    transition: color 0.2s;
    padding: 0.35rem 0;
  }
  .reset-btn:hover { color: var(--ember); }

  /* Main grid */
  .dashboard {
    position: relative;
    z-index: 1;
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap: 1px;
    background: var(--border);
    margin: 1px;
  }

  .panel {
    background: var(--surface);
    padding: 1.8rem 2rem;
    position: relative;
    transition: background 0.2s;
  }

  .panel.wide { grid-column: 1 / -1; }

  .panel-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 1.4rem;
    gap: 1rem;
  }

  .panel-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1.05rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text);
  }

  .panel-sub {
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    color: var(--smoke);
    letter-spacing: 0.06em;
    text-transform: uppercase;
    margin-top: 0.2rem;
  }

  .panel-tag {
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ember);
    background: rgba(255,94,26,0.08);
    border: 1px solid rgba(255,94,26,0.2);
    padding: 0.2rem 0.5rem;
    flex-shrink: 0;
  }

  .chart-wrap {
    position: relative;
    width: 100%;
  }

  /* Pie panel layout */
  .pie-layout {
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .pie-layout .chart-wrap {
    flex: 0 0 260px;
    height: 260px;
  }

  .pie-legend {
    flex: 1;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.7rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.15s;
  }

  .legend-item:last-child { border-bottom: none; }
  .legend-item:hover { padding-left: 0.4rem; }

  .legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .legend-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 0.95rem;
    letter-spacing: 0.06em;
    color: var(--text);
    flex: 1;
  }

  .legend-count {
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    color: var(--ash);
  }

  .legend-bar-wrap {
    width: 60px;
    height: 4px;
    background: var(--surface2);
    border-radius: 2px;
    overflow: hidden;
  }

  .legend-bar-fill {
    height: 100%;
    border-radius: 2px;
    transition: width 0.4s ease;
  }

  /* Tooltip override */
  .chart-tooltip {
    position: absolute;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    padding: 0.5rem 0.8rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 50;
    line-height: 1.6;
    white-space: nowrap;
  }

  /* Status bar */
  .status-bar {
    position: relative;
    z-index: 1;
    background: var(--surface);
    border-top: 1px solid var(--border);
    padding: 0.8rem 3rem;
    display: flex;
    align-items: center;
    gap: 2rem;
    flex-wrap: wrap;
  }

  .status-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--ash);
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }

  /* Interaction highlight pulse */
  @keyframes pulseIn {
    0% { box-shadow: inset 0 0 0 0 rgba(255,94,26,0); }
    50% { box-shadow: inset 0 0 0 2px rgba(255,94,26,0.3); }
    100% { box-shadow: inset 0 0 0 0 rgba(255,94,26,0); }
  }

  .panel.interacting { animation: pulseIn 0.6s ease; }

  /* Animated entry */
  @keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .panel { animation: fadeSlideUp 0.5s ease both; }
  .panel:nth-child(1) { animation-delay: 0.1s; }
  .panel:nth-child(2) { animation-delay: 0.2s; }
  .panel:nth-child(3) { animation-delay: 0.3s; }

  header { animation: fadeSlideUp 0.4s ease both; }

  /* Responsive */
  @media (max-width: 860px) {
    .dashboard { grid-template-columns: 1fr; }
    .panel.wide { grid-column: 1; }
    .pie-layout { flex-direction: column; align-items: stretch; }
    .pie-layout .chart-wrap { flex: 0 0 220px; height: 220px; align-self: center; }
    header { flex-direction: column; align-items: flex-start; }
    .header-stats { flex-wrap: wrap; }
  }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <h1><span class="burn">BURN</span><span class="out">OUT</span><br>MONITOR</h1>
    <p>Engineering Student Wellbeing · n=800 CSV + 10 Survey Participants</p>
  </div>
  <div class="header-stats">
    <div class="stat-pill">
      <span class="num">5.6</span>
      <span class="lbl">Avg Burnout</span>
    </div>
    <div class="stat-pill">
      <span class="num">5.5</span>
      <span class="lbl">Avg Stress</span>
    </div>
    <div class="stat-pill">
      <span class="num">5.97h</span>
      <span class="lbl">Avg Sleep</span>
    </div>
  </div>
</header>

<div class="filter-bar">
  <span class="filter-label">Filter Year:</span>
  <button class="year-btn active" data-year="all"><span>All Years</span></button>
  <button class="year-btn" data-year="1"><span>1st Year</span></button>
  <button class="year-btn" data-year="2"><span>2nd Year</span></button>
  <button class="year-btn" data-year="3"><span>3rd Year</span></button>
  <button class="year-btn" data-year="4"><span>4th Year</span></button>
  <button class="reset-btn" id="resetBtn">↺ Reset Selection</button>
</div>

<div class="dashboard">
  <!-- Panel 1: Pie Chart (Survey) -->
  <div class="panel" id="panelPie">
    <div class="panel-header">
      <div>
        <div class="panel-title">Coping Mechanisms</div>
        <div class="panel-sub">10-participant survey · click segments to filter</div>
      </div>
      <div class="panel-tag">Survey</div>
    </div>
    <div class="pie-layout">
      <div class="chart-wrap">
        <canvas id="pieChart"></canvas>
      </div>
      <div class="pie-legend" id="pieLegend"></div>
    </div>
  </div>

  <!-- Panel 2: Grouped Bar Chart -->
  <div class="panel" id="panelBar">
    <div class="panel-header">
      <div>
        <div class="panel-title">Stress & Burnout by Year</div>
        <div class="panel-sub">n=800 · avg scores 1–10 · click bars to cross-filter</div>
      </div>
      <div class="panel-tag">CSV Data</div>
    </div>
    <div class="chart-wrap" style="height:260px;">
      <canvas id="barChart"></canvas>
    </div>
  </div>

  <!-- Panel 3: Line Chart (wide) -->
  <div class="panel wide" id="panelLine">
    <div class="panel-header">
      <div>
        <div class="panel-title">Academic Pressure Trends Across Years</div>
        <div class="panel-sub">Stress · Burnout · Sleep · Career Clarity · Screen Time — hover for details</div>
      </div>
      <div class="panel-tag">CSV Data · n=800</div>
    </div>
    <div class="chart-wrap" style="height:240px;">
      <canvas id="lineChart"></canvas>
    </div>
  </div>
</div>

<div class="status-bar">
  <div class="status-item">
    <span class="status-dot" style="background:var(--ember)"></span>
    <span id="statusText">Showing all 800 students across 4 years</span>
  </div>
  <div class="status-item" id="interactionHint">
    <span class="status-dot" style="background:var(--smoke)"></span>
    <span>Click any chart element to cross-filter all graphs</span>
  </div>
</div>

<script>
// ─── DATA ────────────────────────────────────────────────────────────────────

const csvData = {
  labels: ['1st Year','2nd Year','3rd Year','4th Year'],
  n: [217, 204, 202, 177],
  stress:       [5.42, 5.60, 5.70, 5.25],
  burnout:      [5.40, 5.57, 5.64, 5.82],
  sleep:        [6.04, 6.01, 5.95, 5.86],
  studyHours:   [5.57, 5.69, 5.47, 5.57],
  screenTime:   [7.37, 7.33, 7.47, 7.31],
  careerClarity:[5.21, 5.49, 5.73, 5.40],
};

// Survey data: 10 participants
const surveyParticipants = [
  { year: 1, burnout: 5, coping: 'Talking to Friends' },
  { year: 1, burnout: 6, coping: 'Social Media' },
  { year: 2, burnout: 6, coping: 'Gym / Exercise' },
  { year: 2, burnout: 7, coping: 'Gaming' },
  { year: 2, burnout: 5, coping: 'Talking to Friends' },
  { year: 3, burnout: 8, coping: 'Gym / Exercise' },
  { year: 3, burnout: 9, coping: 'Gaming' },
  { year: 3, burnout: 7, coping: 'Social Media' },
  { year: 4, burnout: 8, coping: 'Gym / Exercise' },
  { year: 4, burnout: 6, coping: 'Talking to Friends' },
];

const copingColors = {
  'Talking to Friends': '#ff5e1a',
  'Social Media':       '#ffaa00',
  'Gym / Exercise':     '#00c4ff',
  'Gaming':             '#a855f7',
};

const yearColors = ['#ff5e1a','#ffaa00','#00c4ff','#a855f7'];
const yearColorsAlpha = (i, a=0.7) => {
  const c = ['255,94,26','255,170,0','0,196,255','168,85,247'];
  return `rgba(${c[i]},${a})`;
};

// ─── STATE ────────────────────────────────────────────────────────────────────

let selectedYear = null;   // null = all, 1-4
let selectedCoping = null; // null = all

// ─── CHART INSTANCES ─────────────────────────────────────────────────────────

let pieChart, barChart, lineChart;

// ─── HELPERS ─────────────────────────────────────────────────────────────────

const gridColor = 'rgba(42,42,53,0.8)';
const tickColor = '#4a4a5a';

const baseChartDefaults = {
  responsive: true,
  maintainAspectRatio: false,
  animation: { duration: 400, easing: 'easeInOutQuart' },
};

function getFilteredParticipants() {
  let p = surveyParticipants;
  if (selectedYear !== null) p = p.filter(x => x.year === selectedYear);
  if (selectedCoping !== null) p = p.filter(x => x.coping === selectedCoping);
  return p;
}

function copingCounts(participants) {
  const map = {};
  participants.forEach(p => {
    map[p.coping] = (map[p.coping] || 0) + 1;
  });
  return map;
}

// ─── STATUS ──────────────────────────────────────────────────────────────────

function updateStatus() {
  const p = getFilteredParticipants();
  let yearLabel = selectedYear ? `${['','1st','2nd','3rd','4th'][selectedYear]} Year` : 'all years';
  let copingLabel = selectedCoping ? ` · ${selectedCoping}` : '';
  document.getElementById('statusText').textContent =
    `Survey: ${p.length} participant${p.length!==1?'s':''} · ${yearLabel}${copingLabel}  |  CSV data filtered to year group`;
}

// ─── PIE CHART ───────────────────────────────────────────────────────────────

function buildPieLegend(counts) {
  const total = Object.values(counts).reduce((a,b)=>a+b,0);
  const allCopings = Object.keys(copingColors);
  const container = document.getElementById('pieLegend');
  container.innerHTML = '';
  allCopings.forEach(name => {
    const cnt = counts[name] || 0;
    const pct = total > 0 ? (cnt/total*100).toFixed(0) : 0;
    const color = copingColors[name];
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.style.opacity = (selectedCoping && selectedCoping !== name) ? '0.3' : '1';
    item.innerHTML = `
      <span class="legend-dot" style="background:${color}"></span>
      <span class="legend-name">${name}</span>
      <div class="legend-bar-wrap">
        <div class="legend-bar-fill" style="width:${pct}%;background:${color}"></div>
      </div>
      <span class="legend-count">${cnt}</span>
    `;
    item.addEventListener('click', () => {
      if (selectedCoping === name) selectedCoping = null;
      else selectedCoping = name;
      updateAll();
    });
    container.appendChild(item);
  });
}

function initPieChart() {
  const ctx = document.getElementById('pieChart').getContext('2d');
  const participants = getFilteredParticipants();
  const counts = copingCounts(participants);
  const labels = Object.keys(copingColors);
  const data = labels.map(l => counts[l] || 0);
  const colors = labels.map(l => copingColors[l]);

  pieChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels,
      datasets: [{
        data,
        backgroundColor: colors.map(c => c + 'cc'),
        borderColor: colors,
        borderWidth: 2,
        hoverBorderWidth: 3,
        hoverOffset: 8,
      }]
    },
    options: {
      ...baseChartDefaults,
      cutout: '62%',
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1c1c22',
          borderColor: '#2a2a35',
          borderWidth: 1,
          titleFont: { family: 'Space Mono', size: 10 },
          bodyFont: { family: 'Barlow Condensed', size: 14, weight: '600' },
          titleColor: '#8a8a9a',
          bodyColor: '#e8e8f0',
          callbacks: {
            title: ctx => ctx[0].label,
            label: ctx => `  ${ctx.raw} participant${ctx.raw!==1?'s':''}`
          }
        }
      },
      onClick(e, els) {
        if (!els.length) { selectedCoping = null; }
        else {
          const name = labels[els[0].index];
          selectedCoping = (selectedCoping === name) ? null : name;
        }
        updateAll();
        pulsePanel('panelBar');
        pulsePanel('panelLine');
      }
    }
  });
  buildPieLegend(counts);
}

function updatePieChart() {
  const participants = getFilteredParticipants();
  const counts = copingCounts(participants);
  const labels = Object.keys(copingColors);
  const data = labels.map(l => counts[l] || 0);

  // Dim non-selected
  const colors = labels.map(l => {
    const c = copingColors[l];
    if (selectedCoping && selectedCoping !== l) return c + '33';
    return c + 'cc';
  });
  const borders = labels.map(l => {
    if (selectedCoping && selectedCoping !== l) return copingColors[l] + '33';
    return copingColors[l];
  });

  pieChart.data.datasets[0].data = data;
  pieChart.data.datasets[0].backgroundColor = colors;
  pieChart.data.datasets[0].borderColor = borders;
  pieChart.update();
  buildPieLegend(counts);
}

// ─── BAR CHART ───────────────────────────────────────────────────────────────

function getBarAlphas() {
  // If a year is selected, dim others; if a coping is selected, show burnout of that coping group
  return [0,1,2,3].map(i => {
    const y = i+1;
    if (selectedYear === null) return 1;
    return selectedYear === y ? 1 : 0.2;
  });
}

function initBarChart() {
  const ctx = document.getElementById('barChart').getContext('2d');
  barChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: csvData.labels,
      datasets: [
        {
          label: 'Stress',
          data: csvData.stress,
          backgroundColor: [0,1,2,3].map(i => yearColorsAlpha(i, 0.75)),
          borderColor: yearColors,
          borderWidth: 1.5,
          borderRadius: 2,
        },
        {
          label: 'Burnout',
          data: csvData.burnout,
          backgroundColor: [0,1,2,3].map(i => yearColorsAlpha(i, 0.35)),
          borderColor: [0,1,2,3].map(i => yearColors[i]+'88'),
          borderWidth: 1,
          borderRadius: 2,
          borderDash: [4,3],
        }
      ]
    },
    options: {
      ...baseChartDefaults,
      scales: {
        x: {
          grid: { color: gridColor },
          ticks: { color: tickColor, font: { family: 'Space Mono', size: 9 } },
          border: { color: gridColor }
        },
        y: {
          min: 0, max: 10,
          grid: { color: gridColor },
          ticks: { color: tickColor, font: { family: 'Space Mono', size: 9 }, stepSize: 2 },
          border: { color: gridColor }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: tickColor,
            font: { family: 'Barlow Condensed', size: 12 },
            boxWidth: 10, boxHeight: 10,
          }
        },
        tooltip: {
          backgroundColor: '#1c1c22',
          borderColor: '#2a2a35',
          borderWidth: 1,
          titleFont: { family: 'Barlow Condensed', size: 13, weight: '700' },
          bodyFont: { family: 'Space Mono', size: 10 },
          titleColor: '#e8e8f0',
          bodyColor: '#8a8a9a',
          callbacks: {
            afterBody: (ctx) => {
              const yi = ctx[0].dataIndex;
              return [`n = ${csvData.n[yi]} students`];
            }
          }
        }
      },
      onClick(e, els) {
        if (!els.length) { selectedYear = null; }
        else {
          const yi = els[0].index + 1;
          selectedYear = (selectedYear === yi) ? null : yi;
        }
        // Sync filter buttons
        syncYearButtons();
        updateAll();
        pulsePanel('panelPie');
        pulsePanel('panelLine');
      }
    }
  });
}

function updateBarChart() {
  const alphas = getBarAlphas();
  barChart.data.datasets[0].backgroundColor = [0,1,2,3].map(i => yearColorsAlpha(i, alphas[i]*0.75));
  barChart.data.datasets[0].borderColor = [0,1,2,3].map(i => yearColors[i] + Math.round(alphas[i]*255).toString(16).padStart(2,'0'));
  barChart.data.datasets[1].backgroundColor = [0,1,2,3].map(i => yearColorsAlpha(i, alphas[i]*0.35));
  barChart.update();
}

// ─── LINE CHART ───────────────────────────────────────────────────────────────

function initLineChart() {
  const ctx = document.getElementById('lineChart').getContext('2d');
  lineChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: csvData.labels,
      datasets: [
        {
          label: 'Stress',
          data: csvData.stress,
          borderColor: '#ff5e1a',
          backgroundColor: 'rgba(255,94,26,0.08)',
          borderWidth: 2,
          pointRadius: 5,
          pointHoverRadius: 8,
          pointBackgroundColor: '#ff5e1a',
          tension: 0.35,
          fill: false,
        },
        {
          label: 'Burnout',
          data: csvData.burnout,
          borderColor: '#ffaa00',
          backgroundColor: 'rgba(255,170,0,0.06)',
          borderWidth: 2,
          pointRadius: 5,
          pointHoverRadius: 8,
          pointBackgroundColor: '#ffaa00',
          tension: 0.35,
          fill: false,
        },
        {
          label: 'Sleep (hrs)',
          data: csvData.sleep,
          borderColor: '#00c4ff',
          backgroundColor: 'rgba(0,196,255,0.06)',
          borderWidth: 2,
          pointRadius: 5,
          pointHoverRadius: 8,
          pointBackgroundColor: '#00c4ff',
          tension: 0.35,
          fill: false,
        },
        {
          label: 'Career Clarity',
          data: csvData.careerClarity,
          borderColor: '#a855f7',
          backgroundColor: 'rgba(168,85,247,0.06)',
          borderWidth: 2,
          borderDash: [5,3],
          pointRadius: 5,
          pointHoverRadius: 8,
          pointBackgroundColor: '#a855f7',
          tension: 0.35,
          fill: false,
        },
        {
          label: 'Screen Time (hrs)',
          data: csvData.screenTime,
          borderColor: '#50e3c2',
          backgroundColor: 'rgba(80,227,194,0.06)',
          borderWidth: 1.5,
          borderDash: [3,5],
          pointRadius: 4,
          pointHoverRadius: 7,
          pointBackgroundColor: '#50e3c2',
          tension: 0.35,
          fill: false,
        },
      ]
    },
    options: {
      ...baseChartDefaults,
      interaction: { mode: 'index', intersect: false },
      scales: {
        x: {
          grid: { color: gridColor },
          ticks: { color: tickColor, font: { family: 'Space Mono', size: 9 } },
          border: { color: gridColor }
        },
        y: {
          min: 0, max: 10,
          grid: { color: gridColor },
          ticks: { color: tickColor, font: { family: 'Space Mono', size: 9 }, stepSize: 2 },
          border: { color: gridColor }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: tickColor,
            font: { family: 'Barlow Condensed', size: 12 },
            boxWidth: 12, boxHeight: 2,
            usePointStyle: true,
          }
        },
        tooltip: {
          backgroundColor: '#1c1c22',
          borderColor: '#2a2a35',
          borderWidth: 1,
          titleFont: { family: 'Barlow Condensed', size: 14, weight: '700' },
          bodyFont: { family: 'Space Mono', size: 10 },
          titleColor: '#e8e8f0',
          bodyColor: '#8a8a9a',
        }
      },
      onClick(e, els) {
        if (!els.length) { selectedYear = null; }
        else {
          const yi = els[0].index + 1;
          selectedYear = (selectedYear === yi) ? null : yi;
        }
        syncYearButtons();
        updateAll();
        pulsePanel('panelPie');
        pulsePanel('panelBar');
      }
    }
  });
}

function updateLineChart() {
  // Highlight selected year point with larger radius
  lineChart.data.datasets.forEach(ds => {
    ds.pointRadius = [0,1,2,3].map(i => {
      if (selectedYear === null) return 5;
      return (i+1 === selectedYear) ? 9 : 3;
    });
    ds.pointHoverRadius = [0,1,2,3].map(i => {
      if (selectedYear === null) return 8;
      return (i+1 === selectedYear) ? 12 : 5;
    });
    ds.borderWidth = (selectedYear === null) ? 2 : 2;
    ds.segment = selectedYear !== null ? {
      borderColor: ctx => {
        const i = ctx.p0DataIndex;
        const inRange = (i+1 === selectedYear || i === selectedYear-1);
        return inRange ? undefined : ds.borderColor + '33';
      }
    } : undefined;
  });
  lineChart.update();
}

// ─── YEAR FILTER BUTTONS ─────────────────────────────────────────────────────

function syncYearButtons() {
  document.querySelectorAll('.year-btn').forEach(btn => {
    const y = btn.dataset.year;
    const isAll = (y === 'all');
    const isActive = isAll ? selectedYear === null : parseInt(y) === selectedYear;
    btn.classList.toggle('active', isActive);
  });
}

document.querySelectorAll('.year-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const y = btn.dataset.year;
    if (y === 'all') selectedYear = null;
    else {
      const num = parseInt(y);
      selectedYear = (selectedYear === num) ? null : num;
    }
    syncYearButtons();
    updateAll();
    pulsePanel('panelPie');
    pulsePanel('panelBar');
    pulsePanel('panelLine');
  });
});

document.getElementById('resetBtn').addEventListener('click', () => {
  selectedYear = null;
  selectedCoping = null;
  syncYearButtons();
  updateAll();
});

// ─── PANEL PULSE ─────────────────────────────────────────────────────────────

function pulsePanel(id) {
  const el = document.getElementById(id);
  el.classList.remove('interacting');
  void el.offsetWidth;
  el.classList.add('interacting');
}

// ─── UPDATE ALL ───────────────────────────────────────────────────────────────

function updateAll() {
  updatePieChart();
  updateBarChart();
  updateLineChart();
  updateStatus();
}

// ─── INIT ─────────────────────────────────────────────────────────────────────

Chart.defaults.color = tickColor;

initPieChart();
initBarChart();
initLineChart();
updateStatus();
</script>
</body>
</html>
